/**
 * â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
 * â•‘              ğŸ§ª TEST SET - ìµœì¢… ì„±ëŠ¥ í‰ê°€ìš© ë°ì´í„° (Final Evaluation)            â•‘
 * â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
 * â•‘                                                                              â•‘
 * â•‘  âš ï¸  ML ë°ì´í„° ë¶„í•  ì›ì¹™ (Data Split Principle)                                â•‘
 * â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â•‘
 * â•‘  â”‚  1. Training Set (í•™ìŠµ ì„¸íŠ¸) - 70%     â†’ ì•Œê³ ë¦¬ì¦˜ ê°œë°œìš©               â”‚   â•‘
 * â•‘  â”‚  2. Validation Set (ê²€ì¦ ì„¸íŠ¸) - 15%  â†’ íŠœë‹/ë””ë²„ê¹…ìš©                 â”‚   â•‘
 * â•‘  â”‚  3. Test Set (í…ŒìŠ¤íŠ¸ ì„¸íŠ¸) - 15%      â†’ ìµœì¢… ì„±ëŠ¥ í‰ê°€ (ì´ íŒŒì¼)       â”‚   â•‘
 * â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â•‘
 * â•‘                                                                              â•‘
 * â•‘  ğŸš« ì ˆëŒ€ ê¸ˆì§€ ì‚¬í•­:                                                           â•‘
 * â•‘  - ì´ í…ŒìŠ¤íŠ¸ ë¬¸ì¥ë“¤ì„ ì‚¬ì „(dictionary)ì— ì§ì ‘ ì¶”ê°€ ê¸ˆì§€                         â•‘
 * â•‘  - ì´ í…ŒìŠ¤íŠ¸ ë¬¸ì¥ë§Œ í†µê³¼í•˜ëŠ” í•˜ë“œì½”ë”© íŒ¨í„´ ê¸ˆì§€                                  â•‘
 * â•‘  - í…ŒìŠ¤íŠ¸ ê²°ê³¼ë¥¼ ë³´ê³  ì•Œê³ ë¦¬ì¦˜ì„ "ì´ ë¬¸ì¥ì— ë§ê²Œ" ì¡°ì • ê¸ˆì§€                       â•‘
 * â•‘                                                                              â•‘
 * â•‘  âœ… ì˜¬ë°”ë¥¸ ê°œì„  ë°©ë²•:                                                         â•‘
 * â•‘  - ì¼ë°˜í™”ëœ ë¬¸ë²• ê·œì¹™ ê°œì„  (ëª¨ë“  ìœ ì‚¬ ë¬¸ì¥ì— ì ìš©)                               â•‘
 * â•‘  - í˜•íƒœì†Œ ë¶„ì„ê¸° ë¡œì§ ê°œì„                                                     â•‘
 * â•‘  - ì–´ìˆœ ë³€í™˜ ì•Œê³ ë¦¬ì¦˜ ê°œì„                                                     â•‘
 * â•‘                                                                              â•‘
 * â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
 * â•‘                        ìœ ë‹ˆí¬ í…ŒìŠ¤íŠ¸ (Unique Tests - 13 Types)                  â•‘
 * â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
 * â•‘                                                                              â•‘
 * â•‘  ëª©ì :                                                                        â•‘
 * â•‘  ì•Œê³ ë¦¬ì¦˜ ê¸°ë°˜ ë²ˆì—­ ì‹œìŠ¤í…œì˜ ì¢…í•© ëŠ¥ë ¥ ê²€ì¦                                        â•‘
 * â•‘  ì‚¬ì „ ê¸°ë°˜ìœ¼ë¡œëŠ” ë¶ˆê°€ëŠ¥í•œ 13ê°€ì§€ ì˜ì—­ì„ í…ŒìŠ¤íŠ¸                                     â•‘
 * â•‘                                                                              â•‘
 * â•‘  13ê°€ì§€ ìœ í˜•:                                                                  â•‘
 * â•‘  1. ì‹ ì¡°ì–´/ìƒˆë¡œìš´ í‘œí˜„ (Neologisms)                                            â•‘
 * â•‘  2. í•©ì„±ì–´ ì°½ì˜ì„± (Compound Words)                                             â•‘
 * â•‘  3. ë¬¸í™”ì  ë‰˜ì•™ìŠ¤ (Cultural Nuance)                                            â•‘
 * â•‘  4. êµ¬ì¡° ì™„ì „ ë³€í™˜ (Structure Transformation)                                   â•‘
 * â•‘  5. ì•”ì‹œ/í•¨ì¶• ì˜ë¯¸ (Implicit Meaning)                                          â•‘
 * â•‘  6. ê´€ìš©ì–´ ì‘ìš© (Idiomatic Variation)                                          â•‘
 * â•‘  7. ë°˜ì–´/ì•„ì´ëŸ¬ë‹ˆ (Irony & Sarcasm)                                            â•‘
 * â•‘  8. ê·¹ë‹¨ì  ìƒëµ (Extreme Ellipsis)                                             â•‘
 * â•‘  9. ë…¼ë¦¬ ì¶”ë¡  (Logical Inference)                                              â•‘
 * â•‘ 10. ë‹¤ì˜ì–´ êµ¬ë¶„ (Polysemy Disambiguation)                                      â•‘
 * â•‘ 11. ê¸¸ì´ ë¶ˆê· í˜• (Length Asymmetry)                                             â•‘
 * â•‘ 12. ì¡´ëŒ“ë§ ë‰˜ì•™ìŠ¤ (Honorific Nuance)                                           â•‘
 * â•‘ 13. ì˜ì„±ì–´/ì˜íƒœì–´ (Onomatopoeia & Mimetic)                                     â•‘
 * â•‘                                                                              â•‘
 * â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 */
import { describe, expect, it } from 'vitest';
import { uniqueTests } from '../benchmark-data';
import { translate } from '../translator-service';

// í…ŒìŠ¤íŠ¸ ê²°ê³¼ ë¹„êµ í•¨ìˆ˜ (ìœ ì—°í•œ ë§¤ì¹­)
function expectSimilar(result: string, expected: string, input: string): void {
  // 1. ì •í™•íˆ ì¼ì¹˜
  if (result === expected) {
    expect(result).toBe(expected);
    return;
  }

  // 2. í•µì‹¬ ë‹¨ì–´ë“¤ì´ í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸ (75% ì´ìƒ ë§¤ì¹­)
  const expectedWords = expected
    .toLowerCase()
    .split(/[\s,.!?'"]+/)
    .filter((w) => w.length > 2);
  const resultLower = result.toLowerCase();

  const matchedCount = expectedWords.filter((word) => resultLower.includes(word)).length;
  const matchRatio = matchedCount / expectedWords.length;

  // 75% ì´ìƒ ë§¤ì¹­ë˜ë©´ í†µê³¼
  if (matchRatio >= 0.75) {
    expect(matchRatio).toBeGreaterThanOrEqual(0.75);
    return;
  }

  // 3. ë””ë²„ê·¸ ì •ë³´ ì¶œë ¥ í›„ ì‹¤íŒ¨
  console.log(`Input: ${input}`);
  console.log(`Expected: ${expected}`);
  console.log(`Result: ${result}`);
  console.log(`Match ratio: ${(matchRatio * 100).toFixed(1)}%`);
  expect(result).toBe(expected);
}

// uniqueTests ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ ë™ì ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ ìƒì„±
for (const level of uniqueTests) {
  describe(level.nameKo, () => {
    for (const category of level.categories) {
      describe(category.nameKo, () => {
        for (const test of category.tests) {
          it(`[${test.direction}] ${test.input.slice(0, 40)}${test.input.length > 40 ? '...' : ''}`, () => {
            const result = translate(test.input, test.direction);
            expectSimilar(result, test.expected, test.input);
          });
        }
      });
    }
  });
}
