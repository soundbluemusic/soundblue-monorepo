/**
 * â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
 * â•‘              ğŸ§ª TEST SET - ìµœì¢… ì„±ëŠ¥ í‰ê°€ìš© ë°ì´í„° (Final Evaluation)            â•‘
 * â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
 * â•‘                                                                              â•‘
 * â•‘  âš ï¸  ML ë°ì´í„° ë¶„í•  ì›ì¹™ (Data Split Principle)                                â•‘
 * â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â•‘
 * â•‘  â”‚  1. Training Set (í•™ìŠµ ì„¸íŠ¸) - 70%     â†’ ì•Œê³ ë¦¬ì¦˜ ê°œë°œìš©               â”‚   â•‘
 * â•‘  â”‚  2. Validation Set (ê²€ì¦ ì„¸íŠ¸) - 15%  â†’ íŠœë‹/ë””ë²„ê¹…ìš©                 â”‚   â•‘
 * â•‘  â”‚  3. Test Set (í…ŒìŠ¤íŠ¸ ì„¸íŠ¸) - 15%      â†’ ìµœì¢… ì„±ëŠ¥ í‰ê°€ (ì´ íŒŒì¼)       â”‚   â•‘
 * â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â•‘
 * â•‘                                                                              â•‘
 * â•‘  ğŸš« ì ˆëŒ€ ê¸ˆì§€ ì‚¬í•­:                                                           â•‘
 * â•‘  - ì´ í…ŒìŠ¤íŠ¸ ë¬¸ì¥ë“¤ì„ ì‚¬ì „(dictionary)ì— ì§ì ‘ ì¶”ê°€ ê¸ˆì§€                         â•‘
 * â•‘  - ì´ í…ŒìŠ¤íŠ¸ ë¬¸ì¥ë§Œ í†µê³¼í•˜ëŠ” í•˜ë“œì½”ë”© íŒ¨í„´ ê¸ˆì§€                                  â•‘
 * â•‘  - í…ŒìŠ¤íŠ¸ ê²°ê³¼ë¥¼ ë³´ê³  ì•Œê³ ë¦¬ì¦˜ì„ "ì´ ë¬¸ì¥ì— ë§ê²Œ" ì¡°ì • ê¸ˆì§€                       â•‘
 * â•‘                                                                              â•‘
 * â•‘  âœ… ì˜¬ë°”ë¥¸ ê°œì„  ë°©ë²•:                                                         â•‘
 * â•‘  - ì¼ë°˜í™”ëœ ë¬¸ë²• ê·œì¹™ ê°œì„  (ëª¨ë“  ìœ ì‚¬ ë¬¸ì¥ì— ì ìš©)                               â•‘
 * â•‘  - í˜•íƒœì†Œ ë¶„ì„ê¸° ë¡œì§ ê°œì„                                                     â•‘
 * â•‘  - ì–´ìˆœ ë³€í™˜ ì•Œê³ ë¦¬ì¦˜ ê°œì„                                                     â•‘
 * â•‘                                                                              â•‘
 * â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
 * â•‘                 ë„ì–´ì“°ê¸° ì˜¤ë¥˜ + ë¬¸ë§¥ íŒŒì•… í…ŒìŠ¤íŠ¸ (Spacing Error Chaos)            â•‘
 * â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
 * â•‘                                                                              â•‘
 * â•‘  ëª©ì :                                                                        â•‘
 * â•‘  ë„ì–´ì“°ê¸°ê°€ ì—†ì–´ë„ ë¬¸ë§¥ìœ¼ë¡œ ì˜ë¯¸ íŒŒì•… ëŠ¥ë ¥ ê²€ì¦                                    â•‘
 * â•‘  â†’ ë™ìŒì´ì˜ì–´ + ë‹¤ì˜ì–´ + ê°ì • + ê¸°ìˆ  ìš©ì–´ ë™ì‹œ ì²˜ë¦¬                              â•‘
 * â•‘                                                                              â•‘
 * â•‘  4ë‹¨ê³„ ë‚œì´ë„:                                                                 â•‘
 * â•‘  - Level 1: ì§§ì€ ë¬¸ì¥ (ë„ì–´ì“°ê¸° 5-7ê³³)                                         â•‘
 * â•‘  - Level 2: ì¤‘ê°„ ë¬¸ì¥ (ë„ì–´ì“°ê¸° 10-15ê³³)                                       â•‘
 * â•‘  - Level 3: ê¸´ ë¬¸ì¥ (ë„ì–´ì“°ê¸° 20-30ê³³)                                         â•‘
 * â•‘  - Level 4: ë§¤ìš° ê¸´ ë¬¸ì¥ (ë„ì–´ì“°ê¸° 40+ ê³³ + ì˜¤íƒ€)                               â•‘
 * â•‘                                                                              â•‘
 * â•‘  í•µì‹¬ ì›ì¹™:                                                                    â•‘
 * â•‘  âŒ í•˜ë“œì½”ë”© ì ˆëŒ€ ê¸ˆì§€                                                          â•‘
 * â•‘  âœ… ë„ì–´ì“°ê¸° ë³µì› + ë¬¸ë§¥ ê¸°ë°˜ ì˜ë¯¸ íŒŒì•… ì•Œê³ ë¦¬ì¦˜ í•„ìˆ˜                              â•‘
 * â•‘                                                                              â•‘
 * â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 */
import { describe, expect, it } from 'vitest';
import { spacingErrorTests } from '../benchmark-data';
import { translate } from '../translator-service';

// í…ŒìŠ¤íŠ¸ ê²°ê³¼ ë¹„êµ í•¨ìˆ˜ (ìœ ì—°í•œ ë§¤ì¹­)
function expectSimilar(result: string, expected: string, input: string): void {
  // 1. ì •í™•íˆ ì¼ì¹˜
  if (result === expected) {
    expect(result).toBe(expected);
    return;
  }

  // 2. í•µì‹¬ ë‹¨ì–´ë“¤ì´ í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸ (60% ì´ìƒ ë§¤ì¹­)
  // ë„ì–´ì“°ê¸° ì˜¤ë¥˜ í…ŒìŠ¤íŠ¸ì´ë¯€ë¡œ ë” ê´€ëŒ€í•œ ê¸°ì¤€ ì ìš©
  const expectedWords = expected
    .toLowerCase()
    .split(/[\s,.!?'"]+/)
    .filter((w) => w.length > 2);
  const resultLower = result.toLowerCase();

  const matchedCount = expectedWords.filter((word) => resultLower.includes(word)).length;
  const matchRatio = matchedCount / expectedWords.length;

  // 60% ì´ìƒ ë§¤ì¹­ë˜ë©´ í†µê³¼
  if (matchRatio >= 0.6) {
    expect(matchRatio).toBeGreaterThanOrEqual(0.6);
    return;
  }

  // 3. ë””ë²„ê·¸ ì •ë³´ ì¶œë ¥ í›„ ì‹¤íŒ¨
  console.log(`Input: ${input}`);
  console.log(`Expected: ${expected}`);
  console.log(`Result: ${result}`);
  console.log(`Match ratio: ${(matchRatio * 100).toFixed(1)}%`);
  expect(result).toBe(expected);
}

// spacingErrorTests ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ ë™ì ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ ìƒì„±
for (const level of spacingErrorTests) {
  describe(level.nameKo, () => {
    for (const category of level.categories) {
      describe(category.nameKo, () => {
        for (const test of category.tests) {
          it(`[${test.direction}] ${test.input.slice(0, 35)}${test.input.length > 35 ? '...' : ''}`, () => {
            const result = translate(test.input, test.direction);
            expectSimilar(result, test.expected, test.input);
          });
        }
      });
    }
  });
}
