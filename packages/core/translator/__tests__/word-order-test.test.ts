/**
 * â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
 * â•‘              ğŸ§ª TEST SET - ìµœì¢… ì„±ëŠ¥ í‰ê°€ìš© ë°ì´í„° (Final Evaluation)            â•‘
 * â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
 * â•‘                                                                              â•‘
 * â•‘  âš ï¸  ML ë°ì´í„° ë¶„í•  ì›ì¹™ (Data Split Principle)                                â•‘
 * â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â•‘
 * â•‘  â”‚  1. Training Set (í•™ìŠµ ì„¸íŠ¸) - 70%     â†’ ì•Œê³ ë¦¬ì¦˜ ê°œë°œìš©               â”‚   â•‘
 * â•‘  â”‚  2. Validation Set (ê²€ì¦ ì„¸íŠ¸) - 15%  â†’ íŠœë‹/ë””ë²„ê¹…ìš©                 â”‚   â•‘
 * â•‘  â”‚  3. Test Set (í…ŒìŠ¤íŠ¸ ì„¸íŠ¸) - 15%      â†’ ìµœì¢… ì„±ëŠ¥ í‰ê°€ (ì´ íŒŒì¼)       â”‚   â•‘
 * â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â•‘
 * â•‘                                                                              â•‘
 * â•‘  ğŸš« ì ˆëŒ€ ê¸ˆì§€ ì‚¬í•­:                                                           â•‘
 * â•‘  - ì´ í…ŒìŠ¤íŠ¸ ë¬¸ì¥ë“¤ì„ ì‚¬ì „(dictionary)ì— ì§ì ‘ ì¶”ê°€ ê¸ˆì§€                         â•‘
 * â•‘  - ì´ í…ŒìŠ¤íŠ¸ ë¬¸ì¥ë§Œ í†µê³¼í•˜ëŠ” í•˜ë“œì½”ë”© íŒ¨í„´ ê¸ˆì§€                                  â•‘
 * â•‘  - í…ŒìŠ¤íŠ¸ ê²°ê³¼ë¥¼ ë³´ê³  ì•Œê³ ë¦¬ì¦˜ì„ "ì´ ë¬¸ì¥ì— ë§ê²Œ" ì¡°ì • ê¸ˆì§€                       â•‘
 * â•‘                                                                              â•‘
 * â•‘  âœ… ì˜¬ë°”ë¥¸ ê°œì„  ë°©ë²•:                                                         â•‘
 * â•‘  - ì¼ë°˜í™”ëœ ë¬¸ë²• ê·œì¹™ ê°œì„  (ëª¨ë“  ìœ ì‚¬ ë¬¸ì¥ì— ì ìš©)                               â•‘
 * â•‘  - í˜•íƒœì†Œ ë¶„ì„ê¸° ë¡œì§ ê°œì„                                                     â•‘
 * â•‘  - ì–´ìˆœ ë³€í™˜ ì•Œê³ ë¦¬ì¦˜ ê°œì„                                                     â•‘
 * â•‘                                                                              â•‘
 * â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
 * â•‘                    SVOâ†”SOV ì–´ìˆœ ë³€í™˜ í…ŒìŠ¤íŠ¸ (Word Order Conversion)             â•‘
 * â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
 * â•‘                                                                              â•‘
 * â•‘  ëª©ì :                                                                        â•‘
 * â•‘  SOV(í•œêµ­ì–´) â†” SVO(ì˜ì–´) êµ¬ì¡° ì™„ì „ ë³€í™˜ ëŠ¥ë ¥ ê²€ì¦                                â•‘
 * â•‘                                                                              â•‘
 * â•‘  4ë‹¨ê³„ ê¸¸ì´ë³„ í…ŒìŠ¤íŠ¸:                                                          â•‘
 * â•‘  - Level 1: ì§§ì€ ë¬¸ì¥ (5-7 ë‹¨ì–´) - ê¸°ë³¸ ì–´ìˆœ ë³€í™˜                               â•‘
 * â•‘  - Level 2: ì¤‘ê°„ ë¬¸ì¥ (10-15 ë‹¨ì–´) - ë¶€ì‚¬êµ¬ ìœ„ì¹˜ ì¡°ì •                           â•‘
 * â•‘  - Level 3: ê¸´ ë¬¸ì¥ (20-30 ë‹¨ì–´) - ë³µë¬¸ ì²˜ë¦¬                                   â•‘
 * â•‘  - Level 4: ë§¤ìš° ê¸´ ë¬¸ì¥ (40+ ë‹¨ì–´) - ê·¹ë‹¨ì  ë³µì¡ì„±                             â•‘
 * â•‘                                                                              â•‘
 * â•‘  í•µì‹¬ ì›ì¹™:                                                                    â•‘
 * â•‘  âŒ í•˜ë“œì½”ë”© ì ˆëŒ€ ê¸ˆì§€                                                          â•‘
 * â•‘  âœ… ì–´ìˆœ ë³€í™˜ ê·œì¹™ ì•Œê³ ë¦¬ì¦˜ ì ìš© í•„ìˆ˜                                            â•‘
 * â•‘                                                                              â•‘
 * â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 */
import { describe, expect, it } from 'vitest';
import { wordOrderTests } from '../benchmark-data';
import { translate } from '../translator-service';

// í…ŒìŠ¤íŠ¸ ê²°ê³¼ ë¹„êµ í•¨ìˆ˜ (ìœ ì—°í•œ ë§¤ì¹­)
function expectSimilar(result: string, expected: string, input: string): void {
  // 1. ì •í™•íˆ ì¼ì¹˜
  if (result === expected) {
    expect(result).toBe(expected);
    return;
  }

  // 2. í•µì‹¬ ë‹¨ì–´ë“¤ì´ í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸ (65% ì´ìƒ ë§¤ì¹­)
  // ì–´ìˆœ ë³€í™˜ í…ŒìŠ¤íŠ¸ì´ë¯€ë¡œ ë‹¨ì–´ ì¡´ì¬ ì—¬ë¶€ê°€ ì¤‘ìš”
  const expectedWords = expected
    .toLowerCase()
    .split(/[\s,.!?'"]+/)
    .filter((w) => w.length > 2);
  const resultLower = result.toLowerCase();

  const matchedCount = expectedWords.filter((word) => resultLower.includes(word)).length;
  const matchRatio = matchedCount / expectedWords.length;

  // 65% ì´ìƒ ë§¤ì¹­ë˜ë©´ í†µê³¼ (ì–´ìˆœì€ ë‹¤ë¥¼ ìˆ˜ ìˆìŒ)
  if (matchRatio >= 0.65) {
    expect(matchRatio).toBeGreaterThanOrEqual(0.65);
    return;
  }

  // 3. ë””ë²„ê·¸ ì •ë³´ ì¶œë ¥ í›„ ì‹¤íŒ¨
  console.log(`Input: ${input}`);
  console.log(`Expected: ${expected}`);
  console.log(`Result: ${result}`);
  console.log(`Match ratio: ${(matchRatio * 100).toFixed(1)}%`);
  expect(result).toBe(expected);
}

// wordOrderTests ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ ë™ì ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ ìƒì„±
for (const level of wordOrderTests) {
  describe(level.nameKo, () => {
    for (const category of level.categories) {
      describe(category.nameKo, () => {
        for (const test of category.tests) {
          it(`[${test.direction}] ${test.input.slice(0, 40)}${test.input.length > 40 ? '...' : ''}`, () => {
            const result = translate(test.input, test.direction);
            expectSimilar(result, test.expected, test.input);
          });
        }
      });
    }
  });
}
