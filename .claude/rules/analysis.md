# 코드 분석 규칙 (Code Analysis Rules)

AI 어시스턴트가 코드 분석, 리뷰, 개선 제안 시 반드시 따라야 하는 규칙입니다.
(Rules that AI assistants must follow when analyzing code, reviewing, or suggesting improvements.)

---

## 🚫 금지 사항 (Prohibited)

### 1. 근거 없는 심각도 부여 금지 (No Unverified Severity Labels)

```
❌ 잘못된 예:
"HIGH: 메모리 누수 위험이 있습니다"

✅ 올바른 예:
"setTimeout이 cleanup 없이 사용됨.
단, 이 컴포넌트는 unmount되지 않으므로 실제 영향 없음."
```

- HIGH/MEDIUM/LOW 라벨은 **실제 영향 분석 후에만** 사용
- "~할 수 있다", "~위험이 있다"는 **실제 발생 조건 명시 필수**
- 이론적 가능성과 실제 발생 여부 구분

### 2. 검증 없는 개선 제안 금지 (No Unverified Suggestions)

제안 전 반드시 확인:
- [ ] 해당 코드가 **실제로 사용되는가?**
- [ ] 변경 시 **테스트가 깨지는가?**
- [ ] 현재 방식이 **의도적 선택일 수 있는가?**
- [ ] 실제 런타임에서 **문제가 발생하는가?**

```
❌ 잘못된 예:
"useCurrentTool 함수가 반응형이 아닙니다. 수정 필요합니다."

✅ 올바른 예:
"useCurrentTool 함수가 정의되어 있는데,
검색 결과 실제 사용처가 없습니다.
사용 중인지, 의도적으로 남겨둔 것인지 확인 필요합니다."
```

### 3. 에이전트 결과 무검증 전달 금지 (No Unverified Agent Results)

"개선점 찾기" 등의 탐색 작업 후:
- 에이전트 결과를 **그대로 전달하지 않음**
- 각 항목을 **실제 코드에서 수동 검증**
- 검증 불가능한 항목은 **"확인 필요"로 표시**

---

## ✅ 필수 사항 (Required)

### 1. 검증 체크리스트 (Verification Checklist)

개선 제안 전 아래 항목 모두 확인:

| 체크 | 항목 | 확인 방법 |
|------|------|----------|
| [ ] | 실제 사용 여부 | `grep` 또는 `Find References`로 사용처 검색 |
| [ ] | 테스트 영향 | 관련 `.test.ts` 파일에서 사용 여부 확인 |
| [ ] | 의도적 설계 여부 | 주석, 커밋 히스토리, 문서 확인 |
| [ ] | 런타임 영향 | 실제 시나리오에서 문제 발생 조건 분석 |

### 2. 문제 보고 형식 (Issue Reporting Format)

```
❌ 단정적 표현:
"이 코드는 잘못되었습니다."
"이건 안티패턴입니다."
"반드시 수정해야 합니다."

✅ 검증적 표현:
"이 패턴이 있는데, 의도된 것인지 확인 필요합니다."
"다른 방식도 가능한데, 현재 방식을 선택한 이유가 있나요?"
"변경하면 ~한 이점이 있지만, 현재 방식도 ~한 장점이 있습니다."
```

### 3. 불확실할 때 (When Uncertain)

```
❌ 추측으로 단정:
"이건 레거시 코드로 보입니다."

✅ 질문으로 전환:
"이 코드가 레거시인지, 의도적으로 유지하는 것인지 확인해주세요."
```

---

## 📋 분석 프로세스 (Analysis Process)

### 코드 개선점 탐색 시:

| 단계 | 작업 | 주의사항 |
|------|------|---------|
| 1 | 패턴 탐색 | "찾아라" 결과를 바로 신뢰하지 않음 |
| 2 | 사용처 확인 | 정의만 있고 사용 안 되는지 확인 |
| 3 | 테스트 확인 | 테스트에서 의존하는지 확인 |
| 4 | 영향 분석 | 실제 런타임 시나리오 검토 |
| 5 | 대안 비교 | 현재 방식 vs 제안 방식 장단점 |
| 6 | 질문 또는 제안 | 확실하면 제안, 불확실하면 질문 |

---

## 🎯 핵심 원칙 (Core Principles)

1. **"찾아라" ≠ "문제다"**: 탐색 결과가 곧 문제는 아님
2. **심각도는 증거 기반**: 라벨은 실제 영향 확인 후 부여
3. **현재 코드 존중**: 의도적 선택일 수 있음을 인정
4. **질문 > 단정**: 불확실하면 단정 짓지 말고 질문
5. **검증 > 추측**: 추측보다 실제 코드 확인 우선

---

## ⚡ 작업 효율 (Work Efficiency)

### 번들 분석 시 (Bundle Analysis)

| ❌ 비효율 | ✅ 효율 |
|----------|--------|
| 매번 `stats.html` 열기 | CLI로 파일 크기 확인 (`wc -c`, `ls -la`) |
| GUI 확인 요청 | 숫자로 비교 후 결과 보고 |
| `ANALYZE=true` 매번 실행 | 필요 시에만 (최종 확인용) |

```bash
# 빠른 번들 크기 확인
wc -c .output/public/_build/assets/*.js | sort -rn | head -10
```

### 검증과 속도의 균형 (Balance)

- **명백한 개선**: 바로 진행 (예: 미사용 의존성 제거)
- **설계 관련 변경**: 간단히 확인 후 진행
- **GUI 도구**: 사용자 요청 시에만 열기
