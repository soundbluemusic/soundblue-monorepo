/**
 * â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
 * â•‘              ğŸ§ª TEST SET - ìµœì¢… ì„±ëŠ¥ í‰ê°€ìš© ë°ì´í„° (Final Evaluation)            â•‘
 * â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
 * â•‘                                                                              â•‘
 * â•‘  âš ï¸  ML ë°ì´í„° ë¶„í•  ì›ì¹™ (Data Split Principle)                                â•‘
 * â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â•‘
 * â•‘  â”‚  1. Training Set (í•™ìŠµ ì„¸íŠ¸) - 70%     â†’ ì•Œê³ ë¦¬ì¦˜ ê°œë°œìš©               â”‚   â•‘
 * â•‘  â”‚  2. Validation Set (ê²€ì¦ ì„¸íŠ¸) - 15%  â†’ íŠœë‹/ë””ë²„ê¹…ìš©                 â”‚   â•‘
 * â•‘  â”‚  3. Test Set (í…ŒìŠ¤íŠ¸ ì„¸íŠ¸) - 15%      â†’ ìµœì¢… ì„±ëŠ¥ í‰ê°€ (ì´ íŒŒì¼)       â”‚   â•‘
 * â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â•‘
 * â•‘                                                                              â•‘
 * â•‘  ğŸš« ì ˆëŒ€ ê¸ˆì§€ ì‚¬í•­:                                                           â•‘
 * â•‘  - ì´ í…ŒìŠ¤íŠ¸ ë¬¸ì¥ë“¤ì„ ì‚¬ì „(dictionary)ì— ì§ì ‘ ì¶”ê°€ ê¸ˆì§€                         â•‘
 * â•‘  - ì´ í…ŒìŠ¤íŠ¸ ë¬¸ì¥ë§Œ í†µê³¼í•˜ëŠ” í•˜ë“œì½”ë”© íŒ¨í„´ ê¸ˆì§€                                  â•‘
 * â•‘  - í…ŒìŠ¤íŠ¸ ê²°ê³¼ë¥¼ ë³´ê³  ì•Œê³ ë¦¬ì¦˜ì„ "ì´ ë¬¸ì¥ì— ë§ê²Œ" ì¡°ì • ê¸ˆì§€                       â•‘
 * â•‘                                                                              â•‘
 * â•‘  âœ… ì˜¬ë°”ë¥¸ ê°œì„  ë°©ë²•:                                                         â•‘
 * â•‘  - ì¼ë°˜í™”ëœ ë¬¸ë²• ê·œì¹™ ê°œì„  (ëª¨ë“  ìœ ì‚¬ ë¬¸ì¥ì— ì ìš©)                               â•‘
 * â•‘  - í˜•íƒœì†Œ ë¶„ì„ê¸° ë¡œì§ ê°œì„                                                     â•‘
 * â•‘  - ì–´ìˆœ ë³€í™˜ ì•Œê³ ë¦¬ì¦˜ ê°œì„                                                     â•‘
 * â•‘                                                                              â•‘
 * â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
 * â•‘                    ë‹¤ì˜ì–´/ë™ìŒì´ì˜ì–´ í…ŒìŠ¤íŠ¸ (Polysemy & Homonyms)                 â•‘
 * â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
 * â•‘                                                                              â•‘
 * â•‘  ëª©ì :                                                                        â•‘
 * â•‘  ë¬¸ë§¥ ê¸°ë°˜ ì˜ë¯¸ êµ¬ë¶„ ëŠ¥ë ¥ ê²€ì¦                                                   â•‘
 * â•‘  â†’ ê°™ì€ ë‹¨ì–´ê°€ ë¬¸ë§¥ì— ë”°ë¼ ë‹¤ë¥¸ ì˜ë¯¸ë¡œ ë²ˆì—­ë˜ì–´ì•¼ í•¨                               â•‘
 * â•‘                                                                              â•‘
 * â•‘  ë‚œì´ë„ë³„ 3ë‹¨ê³„:                                                               â•‘
 * â•‘  - ì´ˆê¸‰: 2-3ê°œ ì˜ë¯¸, ëª…í™•í•œ ë¬¸ë§¥ ë‹¨ì„œ                                           â•‘
 * â•‘  - ì¤‘ê¸‰: 4-5ê°œ ì˜ë¯¸, ë¬¸ë§¥ íŒŒì•… í•„ìš”                                             â•‘
 * â•‘  - ê³ ê¸‰: 6ê°œ+ ì˜ë¯¸, ë³µí•© ë‹¤ì˜ì–´, ë¯¸ë¬˜í•œ ë‰˜ì•™ìŠ¤                                   â•‘
 * â•‘                                                                              â•‘
 * â•‘  í•µì‹¬ ì›ì¹™:                                                                    â•‘
 * â•‘  âŒ ì‚¬ì „ ê¸°ë°˜: í•˜ë‚˜ì˜ ë‹¨ì–´ì— ì—¬ëŸ¬ ëœ»ì´ ìˆì„ ë•Œ êµ¬ë¶„ ë¶ˆê°€                           â•‘
 * â•‘  âœ… ì•Œê³ ë¦¬ì¦˜ ê¸°ë°˜: ë¬¸ë§¥ì„ í†µí•œ ì •í™•í•œ ì˜ë¯¸ ì„ íƒ                                   â•‘
 * â•‘                                                                              â•‘
 * â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 */
import { describe, expect, it } from 'vitest';
import { polysemyTests } from '../benchmark-data';
import { translate } from '../translator-service';

// í…ŒìŠ¤íŠ¸ ê²°ê³¼ ë¹„êµ í•¨ìˆ˜ (ìœ ì—°í•œ ë§¤ì¹­)
function expectSimilar(result: string, expected: string, input: string): void {
  // 1. ì •í™•íˆ ì¼ì¹˜
  if (result === expected) {
    expect(result).toBe(expected);
    return;
  }

  // 2. í•µì‹¬ ë‹¨ì–´ë“¤ì´ í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸ (70% ì´ìƒ ë§¤ì¹­)
  const expectedWords = expected
    .toLowerCase()
    .split(/[\s,.!?'"]+/)
    .filter((w) => w.length > 2);
  const resultLower = result.toLowerCase();

  const matchedCount = expectedWords.filter((word) => resultLower.includes(word)).length;
  const matchRatio = matchedCount / expectedWords.length;

  // 70% ì´ìƒ ë§¤ì¹­ë˜ë©´ í†µê³¼
  if (matchRatio >= 0.7) {
    expect(matchRatio).toBeGreaterThanOrEqual(0.7);
    return;
  }

  // 3. ë””ë²„ê·¸ ì •ë³´ ì¶œë ¥ í›„ ì‹¤íŒ¨
  console.log(`Input: ${input}`);
  console.log(`Expected: ${expected}`);
  console.log(`Result: ${result}`);
  console.log(`Match ratio: ${(matchRatio * 100).toFixed(1)}%`);
  expect(result).toBe(expected);
}

// polysemyTests ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ ë™ì ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ ìƒì„±
for (const level of polysemyTests) {
  describe(level.nameKo, () => {
    for (const category of level.categories) {
      describe(category.nameKo, () => {
        for (const test of category.tests) {
          it(`[${test.direction}] ${test.input.slice(0, 35)}${test.input.length > 35 ? '...' : ''}`, () => {
            const result = translate(test.input, test.direction);
            expectSimilar(result, test.expected, test.input);
          });
        }
      });
    }
  });
}
