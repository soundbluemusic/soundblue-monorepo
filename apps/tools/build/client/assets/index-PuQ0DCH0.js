import{a as o,p as s}from"./chunk-JMJ3UQ3L-DBUlYMbz.js";import{r as ce,g as B,P as xe,a as oe,R as re,S as K}from"./audio-context-BaDSkjUw.js";import{u as be}from"./index-JNvSJHQl.js";import{c as ae,a as Z}from"./utils-CBr3bUga.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=ae("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=ae("Timer",[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=ae("Volume2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]),$=[{id:"kick",name:"Kick",color:"#ff6b6b"},{id:"snare",name:"Snare",color:"#4ecdc4"},{id:"hihat",name:"Hi-Hat",color:"#ffe66d"},{id:"clap",name:"Clap",color:"#a29bfe"}],ie=28,ue=3,de=52,Q=0,ve=14,X={background:"#1a1a2e",cellInactive:"#2d2d44",beatMarker:"#404060",playhead:"#fbbf24",text:"#ffffff"};function Ce({pattern:b,steps:v,currentStep:U,isPlaying:M,onStepToggle:V,className:d}){const f=o.useRef(null),k=o.useRef(null),D=o.useRef(null),[q,W]=o.useState(!1),[G,ee]=o.useState(!1),[T,E]=o.useState(null),[C,F]=o.useState(1),[P,te]=o.useState(!1),g=o.useCallback(()=>Math.max(ve,ie*C),[C]),x=o.useCallback(()=>Math.max(2,ue*C),[C]),j=o.useCallback(()=>Math.max(36,de*C),[C]),A=o.useCallback(()=>j()+v*(g()+x()),[j,v,g,x]),w=o.useCallback(()=>Q+$.length*(g()+x()),[g,x]),I=o.useCallback((e,n)=>({x:j()+n*(g()+x()),y:Q+e*(g()+x())}),[j,g,x]),L=o.useCallback((e,n)=>{const c=j(),i=g(),u=x();if(e<c)return null;const m=Math.floor((e-c)/(i+u)),p=Math.floor((n-Q)/(i+u));if(m<0||m>=v||p<0||p>=$.length)return null;const S=c+m*(i+u),ne=Q+p*(i+u);if(e>S+i||n>ne+i)return null;const y=$[p];return y?{drumId:y.id,step:m}:null},[j,g,x,v]),z=(e,n,c,i,u,m)=>{e.beginPath(),e.moveTo(n+m,c),e.lineTo(n+i-m,c),e.quadraticCurveTo(n+i,c,n+i,c+m),e.lineTo(n+i,c+u-m),e.quadraticCurveTo(n+i,c+u,n+i-m,c+u),e.lineTo(n+m,c+u),e.quadraticCurveTo(n,c+u,n,c+u-m),e.lineTo(n,c+m),e.quadraticCurveTo(n,c,n+m,c),e.closePath()},O=o.useCallback(()=>{const e=D.current,n=f.current;if(!e||!n)return;const c=window.devicePixelRatio||1;e.clearRect(0,0,n.width,n.height),e.save(),e.scale(c,c);const i=A(),u=w(),m=j(),p=g(),S=x();e.fillStyle=X.background,e.fillRect(0,0,i,u),e.strokeStyle=X.beatMarker,e.globalAlpha=.5,e.lineWidth=1;for(let y=0;y<v;y++)if(y%4===0){const _=m+y*(p+S)-S/2;e.beginPath(),e.moveTo(_,0),e.lineTo(_,u),e.stroke()}e.globalAlpha=1;const ne=Math.max(8,10*C);$.forEach((y,_)=>{const R=Q+_*(p+S);e.globalAlpha=.3,e.fillStyle=y.color,z(e,0,R,m-S,p,4),e.fill(),e.globalAlpha=1,e.fillStyle=X.text,e.font=`${ne}px sans-serif`,e.textAlign="center",e.textBaseline="middle",e.fillText(y.name,(m-S)/2,R+p/2)}),$.forEach((y,_)=>{for(let R=0;R<v;R++){const Y=I(_,R),he=b[y.id]?.[R]??!1,pe=M&&U===R;e.fillStyle=he?y.color:X.cellInactive,z(e,Y.x,Y.y,p,p,4),e.fill(),pe&&(e.strokeStyle=X.playhead,e.lineWidth=2,z(e,Y.x,Y.y,p,p,4),e.stroke())}}),e.restore()},[A,w,j,g,x,I,v,C,b,M,U]),t=o.useCallback(()=>{if(!k.current)return;const e=k.current.clientWidth,n=de+v*(ie+ue),c=Math.min(1,e/n);F(c)},[v]),a=o.useCallback(()=>{if(!f.current)return;t();const e=window.devicePixelRatio||1,n=A(),c=w();f.current.width=n*e,f.current.height=c*e,f.current.style.width=`${n}px`,f.current.style.height=`${c}px`,D.current=f.current.getContext("2d"),D.current&&(te(!0),O())},[t,A,w,O]),r=o.useCallback(e=>{if(!f.current)return{x:0,y:0};const n=f.current.getBoundingClientRect();return{x:e.clientX-n.left,y:e.clientY-n.top}},[]),l=o.useCallback(e=>{const n=r(e),c=L(n.x,n.y);if(c){const u=!(b[c.drumId]?.[c.step]??!1);W(!0),ee(u),E(c.drumId),V(c.drumId,c.step,u),f.current?.setPointerCapture(e.pointerId)}},[r,L,b,V]),h=o.useCallback(e=>{if(!q)return;const n=r(e),c=L(n.x,n.y);c&&c.drumId===T&&V(c.drumId,c.step,G)},[q,r,L,T,G,V]),N=o.useCallback(e=>{q&&(W(!1),E(null),f.current?.releasePointerCapture(e.pointerId))},[q]);return o.useEffect(()=>{requestAnimationFrame(()=>{a()});const e=new ResizeObserver(()=>{t(),a()});return k.current&&e.observe(k.current),()=>{e.disconnect()}},[a,t]),o.useEffect(()=>{P&&O()},[P,O,b,U,M]),s.jsx("div",{ref:k,className:"w-full overflow-x-auto",children:s.jsx("canvas",{ref:f,className:d,style:{width:`${A()}px`,height:`${w()}px`,maxWidth:"none",cursor:"pointer",touchAction:"pan-x pan-y"},onPointerDown:l,onPointerMove:h,onPointerUp:N,onPointerCancel:N})})}const H={kick:{pitch:60,decay:.5,tone:30,punch:80},snare:{pitch:200,decay:.2,tone:50,punch:60},hihat:{pitch:800,decay:.05,tone:90,punch:40},clap:{pitch:400,decay:.15,tone:60,punch:70}},me=[{id:"kick",name:"Kick",icon:"ðŸ”ˆ"},{id:"snare",name:"Snare",icon:"ðŸ¥"},{id:"hihat",name:"Hi-Hat",icon:"ðŸŽ›ï¸"},{id:"clap",name:"Clap",icon:"ðŸ‘"}],se=b=>({kick:Array(b).fill(!1),snare:Array(b).fill(!1),hihat:Array(b).fill(!1),clap:Array(b).fill(!1)}),fe={bpm:120,steps:16,pattern:se(16),volume:.7,swing:0,metronomeEnabled:!1,synth:{...H}},J={ACCENT_FREQ:1500,REGULAR_FREQ:1e3,CLICK_DURATION:.05};function we({settings:b,onSettingsChange:v}){const{t:U}=be(),[M,V]=o.useState(fe),d=o.useMemo(()=>({...fe,...b,...M}),[b,M]),f=o.useCallback(t=>{V(a=>({...a,...t})),v?.(t)},[v]),[k,D]=o.useState(!1),[q,W]=o.useState(-1),[G,ee]=o.useState(!1),T=o.useRef(null),E=o.useRef(0),C=o.useRef(0),F=o.useCallback(t=>d?.synth?.[t]??H[t],[d]),P=o.useCallback((t,a,r)=>{const l=d?.synth??{...H},h=l[t]??H[t];f({synth:{...l,[t]:{...h,[a]:r}}})},[d,f]),te=o.useCallback(t=>{const a=d?.synth??{...H};f({synth:{...a,[t]:{...H[t]}}})},[d,f]),g=o.useCallback(async t=>{await ce();const a=B();w(t,a.currentTime)},[]),x=o.useCallback(()=>d?.pattern??se(d?.steps??16),[d]),j=o.useCallback((t,a)=>x()[t]?.[a]??!1,[x]),A=o.useCallback((t,a)=>{const r=B(),l=r.createOscillator(),h=r.createGain();l.connect(h),h.connect(r.destination);const N=d.volume*.5;l.frequency.value=a?J.ACCENT_FREQ:J.REGULAR_FREQ,l.type="sine",h.gain.setValueAtTime(a?N*.8:N*.5,t),h.gain.exponentialRampToValueAtTime(.01,t+J.CLICK_DURATION),l.start(t),l.stop(t+J.CLICK_DURATION)},[d.volume]),w=o.useCallback((t,a)=>{const r=B(),l=F(t),h=d.volume,N=l.punch/100,e=l.tone/100;if(t==="kick"){const n=r.createOscillator(),c=r.createGain();n.connect(c),c.connect(r.destination);const i=l.pitch*(1+N*2);if(n.frequency.setValueAtTime(i,a),n.frequency.exponentialRampToValueAtTime(Math.max(20,l.pitch),a+.05),n.type="sine",e<.5){const u=r.createOscillator(),m=r.createGain();u.connect(m),m.connect(r.destination),u.frequency.value=l.pitch*.5,u.type="sine",m.gain.setValueAtTime(h*(.5-e),a),m.gain.exponentialRampToValueAtTime(.01,a+l.decay*.8),u.start(a),u.stop(a+l.decay)}c.gain.setValueAtTime(h,a),c.gain.exponentialRampToValueAtTime(.01,a+l.decay),n.start(a),n.stop(a+l.decay)}else if(t==="snare"){const n=r.createOscillator(),c=r.createGain();n.connect(c),c.connect(r.destination),n.frequency.value=l.pitch,n.type="triangle";const i=r.createOscillator(),u=r.createGain();i.frequency.value=800+e*400,i.type="square",i.connect(u),u.connect(r.destination),u.gain.setValueAtTime(h*(.2+e*.3),a),u.gain.exponentialRampToValueAtTime(.01,a+l.decay),i.start(a),i.stop(a+l.decay),c.gain.setValueAtTime(h*N,a),c.gain.exponentialRampToValueAtTime(.01,a+l.decay),n.start(a),n.stop(a+l.decay)}else if(t==="hihat"){const n=r.createOscillator(),c=r.createOscillator(),i=r.createGain();n.connect(i),c.connect(i),i.connect(r.destination),n.frequency.value=l.pitch,n.type="square",c.frequency.value=l.pitch*(1.5+e),c.type="sawtooth",i.gain.setValueAtTime(h*.3,a),i.gain.exponentialRampToValueAtTime(.01,a+l.decay),n.start(a),c.start(a),n.stop(a+l.decay),c.stop(a+l.decay)}else for(let i=0;i<3;i++){const u=r.createOscillator(),m=r.createGain();u.connect(m),m.connect(r.destination),u.frequency.value=l.pitch*(1+e*.5),u.type="sawtooth";const p=a+i*.01,S=h*(1-i*.2)*N;m.gain.setValueAtTime(S,p),m.gain.exponentialRampToValueAtTime(.01,p+l.decay/3),u.start(p),u.stop(p+l.decay/3)}},[F,d.volume]),I=o.useCallback(()=>{const t=B(),a=.1,r=25;for(;E.current<t.currentTime+a;){const l=C.current,h=E.current;d.metronomeEnabled&&l%4===0&&A(h,l===0),me.forEach(n=>{j(n.id,l)&&w(n.id,h)});const N=Math.max(0,(h-t.currentTime)*1e3);setTimeout(()=>W(l),N);const e=60/d.bpm/4;E.current+=e,C.current=(l+1)%d.steps}T.current=setTimeout(I,r)},[d.bpm,d.steps,d.metronomeEnabled,j,w,A]),L=o.useCallback(async()=>{if(k)T.current&&(clearTimeout(T.current),T.current=null),D(!1),W(-1);else{await ce();const t=B();C.current=0,E.current=t.currentTime,I(),D(!0)}},[k,I]),z=o.useCallback((t,a,r)=>{const l=x();if(l[t]?.[a]===r)return;const h={...l};h[t]=[...l[t]||Array(d.steps).fill(!1)],h[t][a]=r,f({pattern:h})},[x,d.steps,f]),O=o.useCallback(()=>{f({pattern:se(d.steps)})},[d.steps,f]);return o.useEffect(()=>()=>{T.current&&clearTimeout(T.current)},[]),s.jsxs("div",{className:"flex h-full flex-col gap-2 p-2 sm:gap-3 sm:p-3",children:[s.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[s.jsxs("div",{className:"flex items-center justify-between gap-2",children:[s.jsxs("div",{className:"flex items-center gap-1.5",children:[s.jsx("button",{type:"button",onClick:L,className:Z("inline-flex h-9 w-9 items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",k?"bg-red-500 text-white hover:bg-red-600":"bg-primary text-primary-foreground hover:bg-primary/90"),children:k?s.jsx(xe,{className:"h-4 w-4"}):s.jsx(oe,{className:"h-4 w-4"})}),s.jsx("button",{type:"button",onClick:O,className:"inline-flex h-9 w-9 items-center justify-center rounded-md border border-input bg-background text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:s.jsx(re,{className:"h-4 w-4"})}),s.jsx("button",{type:"button",onClick:()=>f({metronomeEnabled:!d.metronomeEnabled}),title:U.drumMachine.metronome,className:Z("inline-flex h-9 w-9 items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",d.metronomeEnabled?"bg-primary text-primary-foreground hover:bg-primary/90":"border border-input bg-background hover:bg-accent hover:text-accent-foreground"),children:s.jsx(ye,{className:"h-4 w-4"})})]}),s.jsxs("div",{className:"flex items-center gap-1.5",children:[s.jsx("span",{className:"text-xs text-muted-foreground",children:"BPM"}),s.jsx("input",{type:"number",value:d.bpm,onChange:t=>f({bpm:Math.max(40,Math.min(300,Number.parseInt(t.currentTarget.value,10)||120))}),className:"w-14 rounded border bg-background px-1.5 py-1 text-center text-sm transition-colors hover:bg-black/8 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring dark:hover:bg-white/12"})]})]}),s.jsxs("div",{className:"hidden items-center gap-2 sm:flex",children:[s.jsx(le,{className:"h-4 w-4 text-muted-foreground"}),s.jsx(K,{value:[d.volume*100],onValueChange:([t])=>f({volume:(t??0)/100}),max:100,className:"w-20"})]})]}),s.jsx("div",{className:"-mx-2 min-h-0 flex-1 select-none overflow-x-auto overflow-y-hidden px-2",children:s.jsx(Ce,{pattern:x(),steps:d.steps,currentStep:q,isPlaying:k,onStepToggle:z,className:"rounded-lg"})}),s.jsxs("button",{type:"button",onClick:()=>ee(!G),className:Z("flex w-full items-center justify-center gap-2 border-t py-2","text-sm text-muted-foreground transition-colors hover:text-foreground"),children:[s.jsx(le,{className:"h-4 w-4"}),s.jsx("span",{children:"Drum Synth"}),s.jsx(ge,{className:Z("h-4 w-4 transition-transform",G&&"rotate-180")})]}),G&&s.jsx("div",{className:"max-h-64 space-y-3 overflow-auto border-t bg-muted/30 p-3",children:me.map(t=>{const a=F(t.id);return s.jsxs("div",{className:"rounded-lg border bg-background p-3",children:[s.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-lg",children:t.icon}),s.jsx("span",{className:"text-sm font-medium",children:t.name})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("button",{type:"button",onClick:()=>g(t.id),className:"inline-flex h-7 items-center justify-center rounded-md px-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:s.jsx(oe,{className:"h-3 w-3"})}),s.jsx("button",{type:"button",onClick:()=>te(t.id),className:"inline-flex h-7 items-center justify-center rounded-md px-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:s.jsx(re,{className:"h-3 w-3"})})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsxs("div",{className:"space-y-1",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-xs text-muted-foreground",children:"Pitch"}),s.jsxs("span",{className:"font-mono text-xs",children:[a.pitch,"Hz"]})]}),s.jsx(K,{value:[a.pitch],onValueChange:([r])=>P(t.id,"pitch",r??80),min:t.id==="kick"?20:t.id==="hihat"?400:80,max:t.id==="kick"?150:t.id==="hihat"?2e3:800,step:1})]}),s.jsxs("div",{className:"space-y-1",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-xs text-muted-foreground",children:"Decay"}),s.jsxs("span",{className:"font-mono text-xs",children:[(a.decay*1e3).toFixed(0),"ms"]})]}),s.jsx(K,{value:[a.decay*1e3],onValueChange:([r])=>P(t.id,"decay",(r??100)/1e3),min:10,max:t.id==="kick"?1e3:500,step:1})]}),s.jsxs("div",{className:"space-y-1",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-xs text-muted-foreground",children:"Tone"}),s.jsxs("span",{className:"font-mono text-xs",children:[a.tone,"%"]})]}),s.jsx(K,{value:[a.tone],onValueChange:([r])=>P(t.id,"tone",r??50),min:0,max:100,step:1})]}),s.jsxs("div",{className:"space-y-1",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-xs text-muted-foreground",children:"Punch"}),s.jsxs("span",{className:"font-mono text-xs",children:[a.punch,"%"]})]}),s.jsx(K,{value:[a.punch],onValueChange:([r])=>P(t.id,"punch",r??50),min:0,max:100,step:1})]})]})]},t.id)})})]})}export{we as D};
