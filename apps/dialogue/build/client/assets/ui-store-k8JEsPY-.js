import{R as C}from"./chunk-JMJ3UQ3L-CtBvknmL.js";const O=e=>{let n;const t=new Set,o=(i,v)=>{const f=typeof i=="function"?i(n):i;if(!Object.is(f,n)){const p=n;n=v??(typeof f!="object"||f===null)?f:Object.assign({},n,f),t.forEach(m=>m(n,p))}},s=()=>n,d={setState:o,getState:s,getInitialState:()=>u,subscribe:i=>(t.add(i),()=>t.delete(i))},u=n=e(o,s,d);return d},R=(e=>e?O(e):O),H=e=>e;function A(e,n=H){const t=C.useSyncExternalStore(e.subscribe,C.useCallback(()=>n(e.getState()),[e,n]),C.useCallback(()=>n(e.getInitialState()),[e,n]));return C.useDebugValue(t),t}const _=e=>{const n=R(e),t=o=>A(n,o);return Object.assign(t,n),t},w=(e=>_);function M(e,n){let t;try{t=e()}catch{return}return{getItem:s=>{var r;const l=u=>u===null?null:JSON.parse(u,void 0),d=(r=t.getItem(s))!=null?r:null;return d instanceof Promise?d.then(l):l(d)},setItem:(s,r)=>t.setItem(s,JSON.stringify(r,void 0)),removeItem:s=>t.removeItem(s)}}const y=e=>n=>{try{const t=e(n);return t instanceof Promise?t:{then(o){return y(o)(t)},catch(o){return this}}}catch(t){return{then(o){return this},catch(o){return y(o)(t)}}}},j=(e,n)=>(t,o,s)=>{let r={storage:M(()=>localStorage),partialize:a=>a,version:0,merge:(a,h)=>({...h,...a}),...n},l=!1;const d=new Set,u=new Set;let i=r.storage;if(!i)return e((...a)=>{console.warn(`[zustand persist middleware] Unable to update item '${r.name}', the given storage is currently unavailable.`),t(...a)},o,s);const v=()=>{const a=r.partialize({...o()});return i.setItem(r.name,{state:a,version:r.version})},f=s.setState;s.setState=(a,h)=>(f(a,h),v());const p=e((...a)=>(t(...a),v()),o,s);s.getInitialState=()=>p;let m;const b=()=>{var a,h;if(!i)return;l=!1,d.forEach(c=>{var g;return c((g=o())!=null?g:p)});const S=((h=r.onRehydrateStorage)==null?void 0:h.call(r,(a=o())!=null?a:p))||void 0;return y(i.getItem.bind(i))(r.name).then(c=>{if(c)if(typeof c.version=="number"&&c.version!==r.version){if(r.migrate){const g=r.migrate(c.state,c.version);return g instanceof Promise?g.then(I=>[!0,I]):[!0,g]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,c.state];return[!1,void 0]}).then(c=>{var g;const[I,P]=c;if(m=r.merge(P,(g=o())!=null?g:p),t(m,!0),I)return v()}).then(()=>{S==null||S(m,void 0),m=o(),l=!0,u.forEach(c=>c(m))}).catch(c=>{S==null||S(void 0,c)})};return s.persist={setOptions:a=>{r={...r,...a},a.storage&&(i=a.storage)},clearStorage:()=>{i==null||i.removeItem(r.name)},getOptions:()=>r,rehydrate:()=>b(),hasHydrated:()=>l,onHydrate:a=>(d.add(a),()=>{d.delete(a)}),onFinishHydration:a=>(u.add(a),()=>{u.delete(a)})},r.skipHydration||b(),m||p},x=j;function D(){if(typeof crypto<"u"&&crypto.getRandomValues){const e=new Uint8Array(8);crypto.getRandomValues(e);const n=Array.from(e,t=>t.toString(16).padStart(2,"0")).join("");return Date.now().toString(36)+n}return Date.now().toString(36)+Math.random().toString(36).slice(2,10)}const E=w()(x((e,n)=>({conversations:[],activeConversationId:null,ghostMode:!1,isHydrated:!1,setHydrated:()=>e({isHydrated:!0}),setGhostMode:t=>e({ghostMode:t}),toggleGhostMode:()=>e(t=>({ghostMode:!t.ghostMode})),createConversation:t=>{const o=n();if(o.ghostMode)return e({activeConversationId:null}),null;if(o.activeConversationId){const r=o.conversations.find(l=>l.id===o.activeConversationId);if(r)return r}const s={id:D(),title:"",messages:[t],createdAt:Date.now(),updatedAt:Date.now()};return e({activeConversationId:s.id,conversations:[s,...o.conversations]}),s},addMessage:t=>{const o=n();if(o.ghostMode)return;const s=o.activeConversationId;if(!s)return;const r=o.conversations.findIndex(f=>f.id===s);if(r===-1)return;const l=o.conversations[r];if(!l)return;const d=[...l.messages,t];let u=l.title;!u&&t.role==="user"&&(u=t.content.slice(0,30)+(t.content.length>30?"...":""));const i={...l,messages:d,title:u,updatedAt:Date.now()},v=[...o.conversations];v[r]=i,e({conversations:v})},loadConversation:t=>{const o=n().conversations.find(s=>s.id===t);return o&&e({activeConversationId:t}),o},deleteConversation:t=>{const o=n(),s=o.conversations.filter(r=>r.id!==t);e({conversations:s,activeConversationId:o.activeConversationId===t?null:o.activeConversationId})},clearActive:()=>e({activeConversationId:null}),getActiveConversation:()=>{const t=n();if(t.activeConversationId)return t.conversations.find(o=>o.id===t.activeConversationId)}}),{name:"dialogue-chat-storage",storage:M(()=>localStorage),partialize:e=>({conversations:e.conversations,ghostMode:e.ghostMode}),onRehydrateStorage:()=>e=>{e==null||e.setHydrated()}})),F=w()(e=>({sidebarOpen:!1,sidebarCollapsed:!1,resultPanelOpen:!1,resultContent:null,setSidebarOpen:n=>e({sidebarOpen:n}),toggleSidebar:()=>e(n=>({sidebarOpen:!n.sidebarOpen})),setSidebarCollapsed:n=>e({sidebarCollapsed:n}),toggleSidebarCollapse:()=>e(n=>({sidebarCollapsed:!n.sidebarCollapsed})),setResultPanelOpen:n=>e({resultPanelOpen:n}),toggleResultPanel:()=>e(n=>({resultPanelOpen:!n.resultPanelOpen})),setResultContent:n=>e({resultContent:n,resultPanelOpen:n!==null}),closeResultPanel:()=>e({resultPanelOpen:!1,resultContent:null})}));export{F as a,D as g,E as u};
